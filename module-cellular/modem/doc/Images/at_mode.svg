<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1330px" preserveAspectRatio="none" style="width:418px;height:1330px;background:#F0F0F0;" version="1.1" viewBox="0 0 418 1330" width="418px" zoomAndPan="magnify"><defs><filter height="300%" id="f3yb8nnoq80v4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="79" x="176.5" y="16.708">AT Mode</text><!--MD5=[36105e52843f3f28080f43ce369346ca]
cluster CellularBSP--><rect fill="#FEFECE" filter="url(#f3yb8nnoq80v4)" height="277" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="366" x="14" y="36.9531"/><rect fill="#F0F0F0" height="244.7031" rx="12.5" ry="12.5" style="stroke: #F0F0F0; stroke-width: 1.0;" width="360" x="17" y="66.25"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="14" x2="380" y1="63.25" y2="63.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="158" y="54.9482">CellularBSP</text><!--MD5=[4feec3315c2ae8fe0f31fdbe0936cbea]
cluster CellularWorker--><rect fill="#FEFECE" filter="url(#f3yb8nnoq80v4)" height="554" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="288" x="48" y="386.9531"/><rect fill="#F0F0F0" height="521.7031" rx="12.5" ry="12.5" style="stroke: #F0F0F0; stroke-width: 1.0;" width="282" x="51" y="416.25"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="48" x2="336" y1="413.25" y2="413.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="142.5" y="404.9482">CellularWorker</text><!--MD5=[df0b49b3bcea4a1034e7e56a9608b471]
cluster Channel--><rect fill="#FEFECE" filter="url(#f3yb8nnoq80v4)" height="189" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="176" x="230" y="1013.9531"/><rect fill="#F0F0F0" height="156.7031" rx="12.5" ry="12.5" style="stroke: #F0F0F0; stroke-width: 1.0;" width="170" x="233" y="1043.25"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="230" x2="406" y1="1040.25" y2="1040.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="289.5" y="1031.9482">Channel</text><rect fill="#FEFECE" filter="url(#f3yb8nnoq80v4)" height="64.2344" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="298" x="48" y="71.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="48" x2="346" y1="98.25" y2="98.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="174.5" y="89.9482">UartIrq</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="229" x="53" y="114.3887">Reads data with DMA to static buffer</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="278" x="53" y="128.3574">and packs them into struct with result code.</text><rect fill="#FEFECE" filter="url(#f3yb8nnoq80v4)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="333" x="30.5" y="196.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="30.5" x2="363.5" y1="223.25" y2="223.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="145.5" y="214.9482">SendToWorker</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="313" x="35.5" y="239.3887">Puts structured data into workers MessageBuffer.</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="174" y="332.9482">output</text><ellipse cx="197" cy="313.9531" fill="#FEFECE" rx="6" ry="6" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201.3891" x2="193.6109" y1="318.3422" y2="310.564"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="201.3891" x2="193.6109" y1="310.564" y2="318.3422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="136" x="111" y="365.6514">DMAMessageBuffer</text><rect fill="#FEFECE" height="12" style="stroke: #A80036; stroke-width: 1.5;" width="48" x="173" y="380.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="185" x2="185" y1="380.9531" y2="392.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="197" x2="197" y1="380.9531" y2="392.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="209" x2="209" y1="380.9531" y2="392.9531"/><rect fill="#FEFECE" filter="url(#f3yb8nnoq80v4)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="161" x="116.5" y="458.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="116.5" x2="277.5" y1="485.25" y2="485.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="62" x="166" y="476.9482">ATParser</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="141" x="121.5" y="501.3887">Parses URC packages.</text><rect fill="#FEFECE" filter="url(#f3yb8nnoq80v4)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="180" x="107" y="569.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="107" x2="287" y1="596.25" y2="596.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="117" y="587.9482">CmdAwaitingResponse</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="270.5" y="959.9482">outputWorker</text><ellipse cx="318" cy="940.9531" fill="#FEFECE" rx="6" ry="6" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="322.3891" x2="314.6109" y1="945.3422" y2="937.564"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="322.3891" x2="314.6109" y1="937.564" y2="945.3422"/><rect fill="#FEFECE" filter="url(#f3yb8nnoq80v4)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="143" y="696.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="143" x2="251" y1="723.25" y2="723.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="88" x="153" y="714.9482">CheckIfFOTA</text><rect fill="#FEFECE" filter="url(#f3yb8nnoq80v4)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="64.5" y="823.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="64.5" x2="151.5" y1="850.25" y2="850.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="74.5" y="841.9482">StoreURC</text><rect fill="#FEFECE" filter="url(#f3yb8nnoq80v4)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="100" x="187" y="823.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="187" x2="287" y1="850.25" y2="850.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="197" y="841.9482">FotaService</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="270.5" y="992.6514">ATBuffer</text><rect fill="#FEFECE" height="12" style="stroke: #A80036; stroke-width: 1.5;" width="48" x="294" y="1007.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="306" x2="306" y1="1007.9531" y2="1019.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="318" x2="318" y1="1007.9531" y2="1019.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="330" x2="330" y1="1007.9531" y2="1019.9531"/><rect fill="#FEFECE" filter="url(#f3yb8nnoq80v4)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="143" x="246.5" y="1085.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="246.5" x2="389.5" y1="1112.25" y2="1112.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="284.5" y="1103.9482">ATStream</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="123" x="251.5" y="1128.3887">parses AT message</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="266.5" y="1221.9482">channelOutput</text><ellipse cx="318" cy="1202.9531" fill="#FEFECE" rx="6" ry="6" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="322.3891" x2="314.6109" y1="1207.3422" y2="1199.564"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="322.3891" x2="314.6109" y1="1199.564" y2="1207.3422"/><rect fill="#FEFECE" filter="url(#f3yb8nnoq80v4)" height="50" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="258" y="1269.9531"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="258" x2="378" y1="1296.25" y2="1296.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="268" y="1287.9482">ServiceCellular</text><!--MD5=[a57b3170d04d2bd212a327163f4c8137]
link UartIrq to SendToWorker--><path d="M197,136.0431 C197,153.3131 197,174.6731 197,191.6531 " fill="none" id="UartIrq-&gt;SendToWorker" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="197,196.7731,201,187.7731,197,191.7731,193,187.7731,197,196.7731" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[12c5ee31291134eacafef3eedf3c1f48]
link SendToWorker to output--><path d="M197,247.0731 C197,265.2931 197,289.3931 197,302.8131 " fill="none" id="SendToWorker-&gt;output" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="197,307.8631,201,298.8631,197,302.8631,193,298.8631,197,307.8631" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[e932264d0d3e1dc4eecdd1ce9c7fd236]
link DMAMessageBuffer to ATParser--><path d="M197,393.0631 C197,404.3331 197,432.0731 197,453.7831 " fill="none" id="DMAMessageBuffer-&gt;ATParser" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="197,458.8731,201,449.8731,197,453.8731,193,449.8731,197,458.8731" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[13a40670c7eb8b170560bd331fd78e1e]
link ATParser to CmdAwaitingResponse--><path d="M197,509.1431 C197,525.5131 197,547.2331 197,564.5931 " fill="none" id="ATParser-&gt;CmdAwaitingResponse" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="197,569.8331,201,560.8331,197,564.8331,193,560.8331,197,569.8331" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[777abd894339136b04c29cf487b6773b]
link CmdAwaitingResponse to outputWorker--><path d="M217.92,620.1731 C233.88,639.7431 255.39,668.6131 269,696.9531 C308.98,780.2031 316.37,894.6231 317.71,929.4631 " fill="none" id="CmdAwaitingResponse-&gt;outputWorker" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="317.88,934.6931,321.5945,925.5716,317.7225,929.6956,313.5985,925.8236,317.88,934.6931" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="301" y="790.02">True</text><!--MD5=[8a7a058cbacea9da7579bb2851695ae5]
link CmdAwaitingResponse to CheckIfFOTA--><path d="M181.3,620.1731 C174.36,633.7031 168.49,651.0031 172,666.9531 C173.86,675.3931 177.17,684.0831 180.79,691.9531 " fill="none" id="CmdAwaitingResponse-&gt;CheckIfFOTA" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="183.07,696.7431,182.7987,686.898,180.9142,692.2317,175.5805,690.3472,183.07,696.7431" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="33" x="173" y="663.02">False</text><!--MD5=[fd94f81ce2f3862349c63c5a12cf90a3]
link CheckIfFOTA to StoreURC--><path d="M170.21,747.0531 C161.23,755.9231 151.58,766.3931 144,776.9531 C134.67,789.9531 126.41,805.7131 120.17,819.0831 " fill="none" id="CheckIfFOTA-&gt;StoreURC" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="117.96,823.8931,125.3504,817.383,120.0462,819.3492,118.08,814.045,117.96,823.8931" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="33" x="145" y="790.02">False</text><!--MD5=[2bf7f23f6b2f1fdfd1cbf2b79eff56c5]
link CheckIfFOTA to FotaService--><path d="M189.96,746.9831 C187.05,761.0631 185.49,778.9831 191,793.9531 C194.41,803.2131 200.2,811.9731 206.53,819.6331 " fill="none" id="CheckIfFOTA-&gt;FotaService" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="210.1,823.7731,207.2623,814.3419,206.839,819.9829,201.198,819.5595,210.1,823.7731" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="192" y="790.02">True</text><!--MD5=[460a876a9029e334c616b58fb8501c7e]
link output to DMAMessageBuffer--><path d="M197,320.0631 C197,331.7231 197,360.5131 197,375.8931 " fill="none" id="output-&gt;DMAMessageBuffer" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="197,380.8931,201,371.8931,197,375.8931,193,371.8931,197,380.8931" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[f66c76729024c907a3d48f760668579d]
link ATBuffer to ATStream--><path d="M318,1020.0631 C318,1031.3331 318,1059.0731 318,1080.7831 " fill="none" id="ATBuffer-&gt;ATStream" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="318,1085.8731,322,1076.8731,318,1080.8731,314,1076.8731,318,1085.8731" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[dd80df3ee72f240316d7675a269eb8c4]
link ATStream to channelOutput--><path d="M318,1136.0731 C318,1154.2931 318,1178.3931 318,1191.8131 " fill="none" id="ATStream-&gt;channelOutput" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="318,1196.8631,322,1187.8631,318,1191.8631,314,1187.8631,318,1196.8631" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[8fe72049e9716dbce24d7677e0dd4d3e]
link outputWorker to ATBuffer--><path d="M318,947.0631 C318,958.7231 318,987.5131 318,1002.8931 " fill="none" id="outputWorker-&gt;ATBuffer" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="318,1007.8931,322,998.8931,318,1002.8931,314,998.8931,318,1007.8931" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[4663c35d14db62ee482ccec530d01964]
link channelOutput to ServiceCellular--><path d="M318,1209.0531 C318,1219.6031 318,1244.5631 318,1264.7031 " fill="none" id="channelOutput-&gt;ServiceCellular" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="318,1269.7131,322,1260.7131,318,1264.7131,314,1260.7131,318,1269.7131" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[0b8c942851dcca4227b07d8b7636a161]
@startuml
skinparam BackgroundColor F0F0F0
Title AT Mode

state CellularBSP {
  UartIrq: Reads data with DMA to static buffer
  UartIrq: and packs them into struct with result code.
  UartIrq - -> SendToWorker
  SendToWorker: Puts structured data into workers MessageBuffer.
  SendToWorker - -> output

  state output <<exitPoint>>
}

state CellularWorker{
  state DMAMessageBuffer <<expansionInput>> 

  DMAMessageBuffer - -> ATParser
  ATParser: Parses URC packages.
  ATParser - -> CmdAwaitingResponse
  
  state CmdAwaitingResponse <<choice>>
  CmdAwaitingResponse - - - -> outputWorker : True
  CmdAwaitingResponse - -> CheckIfFOTA : False

  CheckIfFOTA - -> StoreURC : False
  CheckIfFOTA - -> FotaService : True

  state outputWorker <<exitPoint>>
}

output - -> DMAMessageBuffer

state Channel {
  state ATBuffer <<expansionInput>>
  
  ATBuffer - -> ATStream 
  ATStream: parses AT message
  
  ATStream - -> channelOutput

  state channelOutput <<exitPoint>>
}

outputWorker - -> ATBuffer
channelOutput - -> ServiceCellular
@enduml

PlantUML version 1.2020.02(Sun Mar 01 05:22:07 EST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.12+7-post-Debian-2
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>